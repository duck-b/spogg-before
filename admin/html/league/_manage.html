<!DOCTYPE HTML>
<?
	include "dbconn.php";
?>
<html>
	<body>
		<? if($user_no == $pro_no){?>
		<table class="table">
			<thead>
				<tr>
					<th scope="col-2" style="weight:1">#</th>
					<th scope="col-2" style="weight:1">신청인/팀명</th>
					<th scope="col-2" style="weight:1">관리</th>
					<th scope="col-2" style="weight:1">신청일</th>
				</tr>
			</thead>
			<tbody>
				<? $i=0;
					$league_team_result = mysqli_query($conn,"SELECT * FROM league_team WHERE league = '$no'");
					while($league_team_row = mysqli_fetch_array($league_team_result)){
					$i++;
					$apply_user_no = $league_team_row['user'];
					$apply_user_result = mysqli_query($conn,"SELECT * FROM user where no='$apply_user_no'");
					$apply_user_row = mysqli_fetch_array($apply_user_result);
					$apply_team_no = $league_team_row['team'];
					$apply_team_result = mysqli_query($conn,"SELECT * FROM team where no='$apply_team_no'");
					$apply_team_row = mysqli_fetch_array($apply_team_result);
					if($league_team_row['states'] == 1){
						$bt_c1 = 'secondary disabled';
						$bt_c2 = 'success';
						$bt_c3 = 'danger';
					}else if($league_team_row['states'] == 2){
						$bt_c1 = 'primary';
						$bt_c2 = 'secondary disabled';
						$bt_c3 = 'danger';
					}else if($league_team_row['states'] == 3){
						$bt_c1 = 'primary';
						$bt_c2 = 'success';
						$bt_c3 = 'secondary disabled';
					}
					?>
				<tr>
					<th scope="row" style="vertical-align: middle;"><? echo $i;?></th>
					<td style="vertical-align: middle;"><a href="javascript:;" onclick="new_user_page('<? echo $apply_user_no;?>')"><? echo $apply_user_row['name'];?>(<? echo $apply_user_row['id'];?>)</a>/<br><a href="javascript:;" onclick="new_page('<? echo $apply_team_no;?>')"><? echo $apply_team_row['name'];?></a></td>
					<td style="vertical-align: middle;">
						<?if($league_team_row['states'] == 1){
							echo $league_team_row['updated_at']."에 <a style='color:blue'>수락</a>됨";
						}else if($league_team_row['states'] == 2){?>
						<a class="btn btn-primary" href="LeagueTeamUpdateProc.php?no=<? echo $league_team_row['no'];?>&com=acc" role="button">수락</a>
						<a class="btn btn-danger" href="LeagueTeamUpdateProc.php?no=<? echo $league_team_row['no'];?>&com=ref" role="button">거절</a>
						<?}else if($league_team_row['states'] == 3){
							echo $league_team_row['updated_at']."에 <a style='color:red'>거절</a>됨";
						}?>
					</td>
					<td style="vertical-align: middle;"><? echo $league_team_row['created_at'];?></td>
				</tr>
				<? } ?>
			</tbody>
		</table>
		<? } else if(!$user_no){?>
		<div class="card text-center">
			<div class="card-body">
				<h5 class="card-title">로그인이 필요합니다</h5><br>
				<a class="btn btn-primary" href="user.html?user=login" role="button">로그인</a>
			</div>
		</div>
		<? } else { ?>
		<div class="card text-center">
			<div class="card-body">
				<h5 class="card-title"><? echo $league_row['name']?>에 신청하시겠 습니까?</h5><br>
				<a class="btn btn-primary" href="javascript:;" onclick="new_apply_page('<?echo $no;?>')" role="button">신청하기</a>
			</div>
		</div>
		<? } ?>
		<? 	mysqli_close($conn); ?>
	</body>
</html>