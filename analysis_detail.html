<? include("header/header.html");?>
<? include("header/menu.html"); ?>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<style>
canvas {-moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;}
#chartjs-tooltip {opacity: 1;position: absolute;background: rgba(0, 0, 0, .7);color: white;border-radius: 3px;transition: all .1s ease;pointer-events: none;-webkit-transform: translate(-50%, 0);transform: translate(-50%, 0);}
#chartjs-radar {width: 100%;height: 100%;}
.chartjs-tooltip-key {display: inline-block;width: 10px;height: 10px;margin-right: 10px;}
.table_h_g {min-width:600px}
.table_h_g th{width:10%}
.table_h_g td{width:10%}
</style>
<div class="ro_subpage ro_contentList">
	<div class="container-fluid ro_subpage_title_img ro_posi_r">
		<img src="img/subpage_title/content_titleimg.jpg">
		<div class="ro_subpage_nav">
			<p>Analysis Detail</p>
			<ul>
				<li>Home</li>
				<li>Analysis</li>
				<li>Analysis Detail</li>
			</ul>
		</div>
	</div>
	<div class="container ro_subpage_content">
		<?
			// 1 : 타자 2 : 투수
			include "dbconn.php";
			$analysis_query = "SELECT * FROM analysis WHERE number = ".$_GET['no'];
			$analysis_result = mysqli_query($conn,$analysis_query);
			$analysis_row = mysqli_fetch_array($analysis_result);
			$position = $analysis_row['position'];
			if($position == 1){
				$offical_record_table = "league_record_hit";
				$none_record_table = "none_record_hit";
				
			}else if($position == 2){
				$offical_record_table = "league_record_pit";
				$none_record_table = "none_record_pit";
			}
			$record_offical_query = "SELECT	league.name as league_name,
					league_info.years as years,
					".$offical_record_table.".no as no
			FROM user_player_record JOIN ".$offical_record_table." JOIN league_info JOIN league 
			WHERE user_player_record.position = $position AND ".$player_no." = user_player_record.player AND user_player_record.record = ".$offical_record_table.".no AND ".$offical_record_table.".league_info = league_info.no AND league_info.league = league.no
			ORDER BY -league_info.years";
			$record_offical_result = mysqli_query($conn,$record_offical_query);
			$record_none_query = "SELECT no, league_name, years
			FROM ".$none_record_table." 
			WHERE player = $player_no
			ORDER BY -years";
			$record_none_result = mysqli_query($conn,$record_none_query);
			$record_test_query = "SELECT * FROM 
					(SELECT COUNT(*) as at_game, 
						sum(test_record_hit.at_play) AS at_play, 
						sum(test_record_hit.at_bat) AS at_bat, 
						sum(test_record_hit.hit) AS hit, 
						sum(test_record_hit.hit1) AS hit1, 
						sum(test_record_hit.hit2) AS hit2, 
						sum(test_record_hit.hit3) AS hit3, 
						sum(test_record_hit.hr) AS hr, 
						sum(test_record_hit.rbi) AS rbi, 
						sum(test_record_hit.rs) AS rs, 
						sum(test_record_hit.sb) AS sb, 
						sum(test_record_hit.bb) AS bb, 
						sum(test_record_hit.hbp) AS hbp, 
						sum(test_record_hit.so) AS so,
						sum(test_record_hit.sf) AS sf,
						kind, 
						year(game_date) AS new_years 
					FROM test_record_hit 
					WHERE player = $player_no  
					GROUP BY kind, new_years) AS new_table 
				ORDER BY -new_table.new_years, kind";
			$record_test_result = mysqli_query($conn,$record_test_query);
			mysqli_close($conn);
			$i = 1;
		?>
		<!-- 기록 버튼 -->
		<div class="row to_contents_table_category to_mb_20">
			<!-- 기록 입력 -->
			<div class="col-xs-6 col-sm-6 col-md-2 text-center to_contents_table_category_list contents_active" ready="summary_new(<?=$position?>)" id="record_button_0">
				기록 입력
			</div>
			<!-- 공식 기록 -->
			<?
			while($record_offical_row = mysqli_fetch_array($record_offical_result)){?>
			<div class="col-xs-6 col-sm-6 col-md-2 text-center to_contents_table_category_list" onclick="summary_offical(<?=$record_offical_row['no']?>,<?=$position?>)" id="record_button_<?=$i?>">
				<?if(mb_strlen($record_offical_row['league_name'], 'UTF-8') <= 9){
					$league_name = $record_offical_row['league_name'];
				}else{
					$league_name = mb_substr($record_offical_row['league_name'], 0, 8, 'UTF-8')."‥";
				}
				echo $record_offical_row['years']." ".$league_name."</div>";
				$i++;
			} ?>
			<!-- 비공식 기록 -->
			<? while($record_none_row = mysqli_fetch_array($record_none_result)){ ?>
			<div class="col-xs-6 col-sm-6 col-md-2 text-center to_contents_table_category_list" onclick="summary_none(<?=$record_none_row['no']?>,<?=$position?>)" id="record_button_<?=$i?>">
				<?if(mb_strlen($record_none_row['league_name'], 'UTF-8') <= 9){
					$league_name = $record_none_row['league_name'];
				}else{
					$league_name = mb_substr($record_none_row['league_name'], 0, 8, 'UTF-8')."‥";
				}
				echo $record_none_row['years']." ".$league_name."</div>";
				$i++;
			} ?>
			<!-- 연습 기록 -->
			<? while($record_test_row = mysqli_fetch_array($record_test_result)){?>
			<div class="col-xs-6 col-sm-6 col-md-2 text-center to_contents_table_category_list" onclick="summary_test(<?=$record_test_row['kind']?>,<?=$record_test_row['new_years']?>,<?=$position?>)" id="record_button_<?=$i?>">
				<?if($record_test_row['kind'] == 1){
					$kind = "연습경기";
				}else if($record_test_row['kind'] == 2){
					$kind = "용병경기";
				}
				echo $record_test_row['new_years']." ".$kind."</div>";
				$i++;
			} ?>
		</div>
		
		<div class="row to_contents_table table-responsive" id="contents_detail_part2">
			<div class="contents_detail_part2_l" id="contents_detail_part2_l">
				<div class="row">
					<div class="to_titlebar">
						기록요약
					</div>
					<hr>
					<div class="recodetable" id="summary_table">
						<table class="table table_h_g">
							<tr>
								<th>G</th><td>25</td><th>ERA</th><td>2.48</td><th>W</th><td>13</td><th>L</th><td>4</td><th>SV</th><td>0</td>
							</tr>
							<tr>
								<th>HLD</th><td>0</td><th>WPCT</th><td>0.765</td><th>IP</th><td>2598</td><th>NC</th><td>125</td><th>H</th><td>25</td>
							</tr>
							<tr>
								<th>2B</th><td>30</td><th>3B</th><td>1</td><th>HR</th><td>15</td><th>BB</th><td>45</td><th>HBP</th><td>5</td>
							</tr>
							<tr>
								<th>SO</th><td>180</td><th>R</th><td>54</td><th>SAC</th><td>7</td><th>SF</th><td>2</td><th>TBF</th><td>622</td>
							</tr>
							<tr>
								<th>K/BB</th><td>3.60</td><th>P/G</th><td>103.9</td><th>P/IP</th><td>17.0</td><th>AVG</th><td>0.222</td><th>WHIP</th><td>1.15</td>
							</tr>
						</table>					
					</div>
				</div>
			</div>
			<div class="ro_dp_n contents_detail_part2_r" id="contents_detail_part2_r">
			</div>
		</div>
		
		<div class="ro_dp_n contents_detail_part3" id="contents_detail_part3">
		
		</div>
		
		<div class="to_mt_20 to_mb_20 text-center btn_contents" id="btn_contents">
			<input type="button" class="btn btn_contents_analysis" value="분석하기" onclick="contents_analysis()">
		</div>
	</div>
</div>

<script type="text/javascript">
	function summary_offical(num, pos){
		$.ajax({
			type: 'POST',
			url: 'analysis/offical_table.php',
			data: {
				no : num,
				position : pos
			},
			dataTpye: 'text',
			success: function(data){
				document.getElementById("summary_table").innerHTML = data;
			},
			error: function() {
				alert('Error');
			}
		});
	}
	function contents_analysis() {
		
		var analysisResult = "<div class='to_titlebar to_mt_20'>"
							+"분석결과"
							+"</div>"
							+"<hr>"
							+"<table class='table table_h_b'>"
							+"<tr><th>예측기록</th><th>결과</th></tr>"
							+"<tr><td class='bg_g'>AVG</td><td>0.716</td></tr>"
							+"<tr><td class='bg_g'>OBP</td><td>0.751</td></tr>"
							+"<tr><td class='bg_g'>BB/K</td><td>3.07</td></tr>"
							+"<tr><td class='bg_g'>M/G</td><td>2.2</td></tr>"
							+"<tr><td class='bg_g'>SB/G</td><td>1.8</td></tr>"
							+"<tr><td class='bg_g'>R/G</td><td>1.8</td></tr>"
							+"<tr><td class='bg_g'>RBI/G</td><td>1.9</td></tr>"
							+"</table>";
		
		var analysisGraph =  "<div class='to_titlebar'>"
							+"분석그래프"
							+"</div>"
							+"<hr>"
							+"<div class='analysisGraphDiv' id='chartjs-radar'>"
							+"<canvas id='radarChart' class='analysisGraph'></canvas>"
							+"</div>";
							
		var contents_detail_part3 = "<div class='to_titlebar to_mt_20'>"
							+"Contents"
							+"</div>"
							+"<hr>"
							+"<div class='row to_mb_30'>"
							+"<div class='col-xs-6 col-sm-6 col-md-3'>"
							+"	<div class='contents_list'>"	
							+"		<img src='img/sampleimg/TRYOUT_DESIGN1-18.png'>"
							+"		<div class='contents_list_info'>"
							+"			<p>Contents TItle</p>"
							+"			<span>Contents sub title</span>"
							+"			<small>Contents</small>"
							+"		</div>"
							+"		<div class='contents_list_btn'>"
							+"			<ul>"
							+"				<li><img src='img/button/save.png'>저장하기</li>"
							+"				<li><img src='img/button/share.png'>공유하고 저장하기</li>"
							+"			</ul>"
							+"		</div>"
							+"	</div>"
							+"</div>"
							+"<div class='col-xs-6 col-sm-6 col-md-3'>"
							+"	<div class='contents_list'>"	
							+"		<img src='img/sampleimg/TRYOUT_DESIGN1-20.png'>"
							+"		<div class='contents_list_info'>"
							+"			<p>Contents TItle</p>"
							+"			<span>Contents sub title</span>"
							+"			<small>Contents</small>"
							+"		</div>"
							+"		<div class='contents_list_btn'>"
							+"			<ul>"
							+"				<li><img src='img/button/save.png'>저장하기</li>"
							+"				<li><img src='img/button/share.png'>공유하고 저장하기</li>"
							+"			</ul>"
							+"		</div>"
							+"	</div>"
							+"</div>"
							+"<div class='col-xs-6 col-sm-6 col-md-3'>"
							+"	<div class='contents_list'>"	
							+"		<img src='img/sampleimg/TRYOUT_DESIGN1-18.png'>"
							+"		<div class='contents_list_info'>"
							+"			<p>Contents TItle</p>"
							+"			<span>Contents sub title</span>"
							+"			<small>Contents</small>"
							+"		</div>"
							+"		<div class='contents_list_btn'>"
							+"			<ul>"
							+"				<li><img src='img/button/save.png'>저장하기</li>"
							+"				<li><img src='img/button/share.png'>공유하고 저장하기</li>"
							+"			</ul>"
							+"		</div>"
							+"	</div>"
							+"</div>"
							+"<div class='col-xs-6 col-sm-6 col-md-3'>"
							+"	<div class='contents_list'>"	
							+"		<img src='img/sampleimg/TRYOUT_DESIGN1-30.png'>"
							+"		<div class='contents_list_info'>"
							+"			<p>Contents TItle</p>"
							+"			<span>Contents sub title</span>"
							+"			<small>Contents</small>"
							+"		</div>"
							+"		<div class='contents_list_btn'>"
							+"			<ul>"
							+"				<li><img src='img/button/save.png'>저장하기</li>"
							+"				<li><img src='img/button/share.png'>공유하고 저장하기</li>"
							+"			</ul>"
							+"		</div>"
							+"	</div>"
							+"</div>"
							+"</div>";					
		
		$("#contents_detail_part2_r").removeClass("ro_dp_n");
		
		$("#contents_detail_part2_l").addClass("col-xs-12 col-sm-12 col-md-6");
		$("#contents_detail_part2_l").append(analysisResult);
		$("#contents_detail_part2_r").addClass("col-xs-12 col-sm-12 col-md-6");
		$("#contents_detail_part2_r").append(analysisGraph);
		$("#btn_contents").addClass("ro_dp_n");
		
		$("#contents_detail_part3").removeClass("ro_dp_n");
		$("#contents_detail_part3").append(contents_detail_part3);
		
		var ctxR = document.getElementById("radarChart").getContext('2d');
		var myRadarChart = new Chart(ctxR, {
			type : 'radar',
			data : {
				labels : ["정확", "선구", "파워", "주루", "작전"],
				datasets : [ {
					label : "선수능력치",
					data : [ 65, 59, 90, 81, 56],
					backgroundColor : [ 'rgba(105, 0, 132, .2)', ],
					borderColor : [ 'rgba(200, 99, 132, .7)', ],
					borderWidth : 2
				}, {
					label : "리그평균",
					data : [ 50, 48, 40, 79, 96],
					backgroundColor : [ 'rgba(0, 250, 220, .2)', ],
					borderColor : [ 'rgba(0, 213, 132, .7)', ],
					borderWidth : 2
				} ]
			},
			options : {
				responsive : true
			}
		});
	}
</script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
	<script type="text/javascript">
		//radar
		
	</script>

<? include("footer/footer.html"); ?>	
</body>
</html>